# åˆ‡æ¢åˆ° paddleocr4android (æ–¹æ¡ˆä¸€) æŒ‡å—

## âœ… å·²å®Œæˆçš„æ­¥éª¤

1. âœ… æ·»åŠ  JitPack ä»“åº“åˆ° `settings.gradle.kts`
2. âœ… æ·»åŠ  `paddleocr4android:v1.2.9` ä¾èµ–åˆ° `app/build.gradle.kts`
3. âœ… åˆ›å»º `PaddleOCRManager.kt` OCR ç®¡ç†ç±»
4. âœ… æ¸…ç†æ—§çš„ Paddle Lite æ–‡ä»¶ï¼ˆjarã€.soã€.nbï¼‰

## ğŸ“‹ æ¥ä¸‹æ¥éœ€è¦æ‰‹åŠ¨å®Œæˆçš„æ­¥éª¤

### æ­¥éª¤ 1: ä¸‹è½½æ¨¡å‹æ–‡ä»¶ âš ï¸

æ–¹æ¡ˆä¸€éœ€è¦åŸå§‹çš„ `.pdmodel` å’Œ `.pdiparams` æ–‡ä»¶ï¼Œè€Œä¸æ˜¯ `.nb` æ–‡ä»¶ã€‚

**æ–¹å¼1ï¼šç›´æ¥ä¸‹è½½ï¼ˆæ¨èï¼‰**
```powershell
# åœ¨é¡¹ç›®æ ¹ç›®å½•æ‰§è¡Œ
Invoke-WebRequest -Uri "https://paddleocr.bj.bcebos.com/PP-OCRv3/chinese/ch_PP-OCRv3_det_infer.tar" -OutFile "ch_PP-OCRv3_det_infer.tar"
Invoke-WebRequest -Uri "https://paddleocr.bj.bcebos.com/PP-OCRv3/chinese/ch_PP-OCRv3_rec_infer.tar" -OutFile "ch_PP-OCRv3_rec_infer.tar"
Invoke-WebRequest -Uri "https://paddleocr.bj.bcebos.com/dygraph_v2.0/ch/ch_ppocr_mobile_v2.0_cls_infer.tar" -OutFile "ch_ppocr_mobile_v2.0_cls_infer.tar"
```

**æ–¹å¼2ï¼šæµè§ˆå™¨ä¸‹è½½**
- æ£€æµ‹æ¨¡å‹: https://paddleocr.bj.bcebos.com/PP-OCRv3/chinese/ch_PP-OCRv3_det_infer.tar
- è¯†åˆ«æ¨¡å‹: https://paddleocr.bj.bcebos.com/PP-OCRv3/chinese/ch_PP-OCRv3_rec_infer.tar
- æ–¹å‘åˆ†ç±»: https://paddleocr.bj.bcebos.com/dygraph_v2.0/ch/ch_ppocr_mobile_v2.0_cls_infer.tar

### æ­¥éª¤ 2: è§£å‹å¹¶æ”¾ç½®æ¨¡å‹æ–‡ä»¶ âš ï¸

**è§£å‹ tar æ–‡ä»¶**ï¼ˆä½¿ç”¨ 7-Zip æˆ– WinRARï¼‰ï¼š
```powershell
# æˆ–ä½¿ç”¨ tar å‘½ä»¤ï¼ˆWindows 10+ï¼‰
tar -xf ch_PP-OCRv3_det_infer.tar
tar -xf ch_PP-OCRv3_rec_infer.tar
tar -xf ch_ppocr_mobile_v2.0_cls_infer.tar
```

**å°†æ–‡ä»¶æ”¾åˆ°ä»¥ä¸‹ç»“æ„**ï¼š

```
app/src/main/assets/
â”œâ”€â”€ models/
â”‚   â”œâ”€â”€ det/
â”‚   â”‚   â”œâ”€â”€ inference.pdmodel     â† ä» ch_PP-OCRv3_det_infer/ å¤åˆ¶
â”‚   â”‚   â””â”€â”€ inference.pdiparams   â† ä» ch_PP-OCRv3_det_infer/ å¤åˆ¶
â”‚   â”œâ”€â”€ rec/
â”‚   â”‚   â”œâ”€â”€ inference.pdmodel     â† ä» ch_PP-OCRv3_rec_infer/ å¤åˆ¶
â”‚   â”‚   â””â”€â”€ inference.pdiparams   â† ä» ch_PP-OCRv3_rec_infer/ å¤åˆ¶
â”‚   â””â”€â”€ cls/
â”‚       â”œâ”€â”€ inference.pdmodel     â† ä» ch_ppocr_mobile_v2.0_cls_infer/ å¤åˆ¶
â”‚       â””â”€â”€ inference.pdiparams   â† ä» ch_ppocr_mobile_v2.0_cls_infer/ å¤åˆ¶
â””â”€â”€ ppocr_keys_v1.txt  # å­—å…¸æ–‡ä»¶ï¼ˆè§æ­¥éª¤3ï¼‰
```

**PowerShell å‘½ä»¤å¿«é€Ÿå¤åˆ¶**ï¼š
```powershell
# å‡è®¾å·²è§£å‹åˆ°å½“å‰ç›®å½•
Copy-Item "ch_PP-OCRv3_det_infer\inference.pdmodel" "app\src\main\assets\models\det\"
Copy-Item "ch_PP-OCRv3_det_infer\inference.pdiparams" "app\src\main\assets\models\det\"

Copy-Item "ch_PP-OCRv3_rec_infer\inference.pdmodel" "app\src\main\assets\models\rec\"
Copy-Item "ch_PP-OCRv3_rec_infer\inference.pdiparams" "app\src\main\assets\models\rec\"

Copy-Item "ch_ppocr_mobile_v2.0_cls_infer\inference.pdmodel" "app\src\main\assets\models\cls\"
Copy-Item "ch_ppocr_mobile_v2.0_cls_infer\inference.pdiparams" "app\src\main\assets\models\cls\"
```

### æ­¥éª¤ 3: ä¸‹è½½å­—å…¸æ–‡ä»¶ âš ï¸

ä» PaddleOCR ä»“åº“ä¸‹è½½ `ppocr_keys_v1.txt`:

```powershell
Invoke-WebRequest -Uri "https://raw.githubusercontent.com/PaddlePaddle/PaddleOCR/release/2.7/ppocr/utils/ppocr_keys_v1.txt" -OutFile "app\src\main\assets\ppocr_keys_v1.txt"
```

æˆ–æ‰‹åŠ¨ä¸‹è½½: https://raw.githubusercontent.com/PaddlePaddle/PaddleOCR/release/2.7/ppocr/utils/ppocr_keys_v1.txt

ä¿å­˜åˆ° `app/src/main/assets/ppocr_keys_v1.txt`

### æ­¥éª¤ 4: Sync é¡¹ç›®å¹¶æµ‹è¯• ğŸ¯

1. **åŒæ­¥é¡¹ç›®**: 
   - ç‚¹å‡» Android Studio é¡¶éƒ¨çš„ "Sync Now" æŒ‰é’®
   - æˆ–è¿è¡Œ: `gradlew build --refresh-dependencies`

2. **æ¸…ç†å¹¶é‡æ–°æ„å»º**:
```powershell
.\gradlew clean
.\gradlew assembleDebug
```

3. **å®‰è£…åˆ°è®¾å¤‡**:
```powershell
.\gradlew installDebug
```

4. **æµ‹è¯• OCR åŠŸèƒ½**: è¿è¡Œåº”ç”¨å¹¶æ‰“å¼€ OCR åŠŸèƒ½

---

## ğŸ¯ å¦‚ä½•ä½¿ç”¨ PaddleOCRManager

åœ¨ä½ çš„ ViewModel æˆ– Activity ä¸­ï¼š

```kotlin
import com.example.speedcalendar.ocr.PaddleOCRManager
import com.example.speedcalendar.ocr.OcrResult

// åˆå§‹åŒ–ï¼ˆåº”ç”¨å¯åŠ¨æ—¶ï¼‰
viewModelScope.launch {
    val success = PaddleOCRManager.getInstance(context).init()
    if (success) {
        Log.d("OCR", "åˆå§‹åŒ–æˆåŠŸ")
    }
}

// è¯†åˆ«å›¾ç‰‡
viewModelScope.launch {
    val result: OcrResult = PaddleOCRManager.getInstance(context).recognize(bitmap)
    if (result.success) {
        println("è¯†åˆ«ç»“æœ: ${result.text}")
        println("è€—æ—¶: ${result.inferenceTime}ms")
    } else {
        println("è¯†åˆ«å¤±è´¥: ${result.error}")
    }
}
```

---

## ğŸ¯ æ–¹æ¡ˆä¸€çš„ä¼˜åŠ¿

- âœ… ä¸éœ€è¦æ‰‹åŠ¨ç®¡ç† native åº“
- âœ… é›†æˆç®€å•ï¼Œä»£ç é‡å°‘
- âœ… ç¤¾åŒºç»´æŠ¤æ´»è·ƒ
- âœ… é€‚åˆå¿«é€ŸéªŒè¯å’Œå°å‹é¡¹ç›®

## âš ï¸ æ³¨æ„äº‹é¡¹

- APK ä¼šå¢åŠ çº¦ 50MBï¼ˆåŒ…å«æ‰€æœ‰æ¶æ„çš„åº“ï¼‰
- é¦–æ¬¡åŠ è½½éœ€è¦å¤åˆ¶æ¨¡å‹åˆ°ç¼“å­˜ç›®å½•ï¼ˆå¯èƒ½éœ€è¦å‡ ç§’ï¼‰
- æ¨¡å‹æ–‡ä»¶æ€»å¤§å°çº¦ 10MBï¼Œä¼šä» assets å¤åˆ¶åˆ°ç¼“å­˜

---

## ğŸ“ å¸¸è§é—®é¢˜

### Q: æ‰¾ä¸åˆ° JitPack ä»“åº“ï¼Ÿ
A: ç¡®ä¿ç½‘ç»œæ­£å¸¸ï¼ŒJitPack å¯èƒ½éœ€è¦ä»£ç†è®¿é—®ã€‚ä¹Ÿå¯ä»¥å°è¯•é˜¿é‡Œäº‘é•œåƒã€‚

### Q: è¯†åˆ«é€Ÿåº¦æ…¢ï¼Ÿ
A: é¦–æ¬¡å¯åŠ¨ä¼šå¤åˆ¶æ¨¡å‹æ–‡ä»¶ï¼Œåç»­ä¼šç›´æ¥ä½¿ç”¨ç¼“å­˜ã€‚å¯ä»¥åœ¨å¯åŠ¨ç”»é¢åˆå§‹åŒ– OCRã€‚

### Q: å´©æºƒæˆ–æ— æ³•åŠ è½½æ¨¡å‹ï¼Ÿ
A: æ£€æŸ¥ assets/models/ ç›®å½•ç»“æ„æ˜¯å¦æ­£ç¡®ï¼Œç¡®ä¿æ–‡ä»¶åä¸º `inference.pdmodel` å’Œ `inference.pdiparams`ã€‚

---

**ä¸‹ä¸€æ­¥**: æŒ‰ç…§æ­¥éª¤ 1-4 å®Œæˆæ¨¡å‹æ–‡ä»¶é…ç½®ï¼Œç„¶å Sync å¹¶æµ‹è¯•ï¼ ğŸš€

